# LIFF Apps Integration Fix

## ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö

LIFF Apps ‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô Job ID ‡πÄ‡∏û‡∏£‡∏≤‡∏∞:

1. **Job Creation** ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á LIFF URL ‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
2. **Quotation, Status Update, etc.** ‚Üí ‡∏£‡∏≠‡∏£‡∏±‡∏ö `jobId` ‡∏à‡∏≤‡∏Å URL parameter ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏™‡πà‡∏á‡∏°‡∏≤‡πÉ‡∏´‡πâ
3. **LINE Notifications** ‚Üí ‡∏™‡πà‡∏á‡πÅ‡∏Ñ‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ ‡πÑ‡∏°‡πà‡∏°‡∏µ LIFF URLs

## ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏

‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á **Flex Message with Action Buttons** ‡∏ó‡∏µ‡πà‡∏°‡∏µ LIFF URLs

## ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ

‡πÄ‡∏û‡∏¥‡πà‡∏° LIFF URLs ‡πÉ‡∏ô LINE Notifications ‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô:

### 1. ‡∏´‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô (Job Created)
```
üìÑ ‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤: [‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π] ‚Üí liff://2008297943-16G8DPPz?jobId=PDC-202510-0001
```

### 2. ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ (Quotation Approved)
```
üìã ‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô: [‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π] ‚Üí liff://2008297943-goJa0bbw?jobId=PDC-202510-0001
```

### 3. ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Status Update)
```
üîî ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: [‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó] ‚Üí liff://2008297943-n63AYqqD?jobId=PDC-202510-0001
```

### 4. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (Final Test)
```
‚ö° ‡∏ó‡∏î‡∏™‡∏≠‡∏ö: [‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•] ‚Üí liff://2008297943-lvmPvjjb?jobId=PDC-202510-0001
```

### 5. ‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à (Final Report)
```
‚úÖ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: [‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô] ‚Üí liff://2008297943-RqO9znnK?jobId=PDC-202510-0001
```

## LIFF IDs (‡∏à‡∏≤‡∏Å config.js)

```javascript
const LIFF_IDS = {
  JOB_CREATION: '2008297943-J69z7PPp',
  QUOTATION: '2008297943-16G8DPPz',
  STATUS_UPDATE: '2008297943-n63AYqqD',
  FINAL_TEST: '2008297943-lvmPvjjb',
  WORK_ORDER: '2008297943-goJa0bbw',
  FINAL_REPORT: '2008297943-RqO9znnK'
};
```

## ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ:

1. **config.js** - ‡πÄ‡∏û‡∏¥‡πà‡∏° LIFF IDs
2. **LineAPI.js** - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô notification ‡πÉ‡∏´‡πâ‡∏£‡∏ß‡∏° LIFF URLs
3. **WebhookInternal.js** - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° LIFF URLs ‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á `/job`, `/pending`
4. **WebhookExternal.js** - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° LIFF URLs ‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", "‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô"

## Data Flow (‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô)

```
1. Sales ‚Üí Job Creation LIFF ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏≤‡∏ô ‚Üí ‚úÖ
2. System ‚Üí ‡∏™‡πà‡∏á Quotation LIFF URL ‚Üí ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‚Üí ‚úÖ
3. ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î Quotation LIFF (with jobId) ‚Üí ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‚Üí ‚úÖ
4. System ‚Üí ‡∏™‡πà‡∏á Work Order LIFF URL ‚Üí ‡∏ä‡πà‡∏≤‡∏á ‚Üí ‚úÖ
5. ‡∏ä‡πà‡∏≤‡∏á ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î Work Order LIFF (with jobId) ‚Üí ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô ‚Üí ‚úÖ
6. ‡∏ä‡πà‡∏≤‡∏á ‚Üí ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡πà‡∏≤‡∏ô Status Update LIFF (with jobId) ‚Üí ‚úÖ
7. ‡∏ä‡πà‡∏≤‡∏á ‚Üí ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô Final Test LIFF (with jobId) ‚Üí ‚úÖ
8. ‡∏ä‡πà‡∏≤‡∏á ‚Üí ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡πà‡∏≤‡∏ô Final Report LIFF (with jobId) ‚Üí ‚úÖ
9. System ‚Üí ‡∏™‡πà‡∏á Final Report PDF ‚Üí ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‚Üí ‚úÖ
```

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Flex Message

```javascript
{
  type: 'flex',
  altText: '‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ PDC-202510-0001',
  contents: {
    type: 'bubble',
    body: {
      type: 'box',
      layout: 'vertical',
      contents: [
        {
          type: 'text',
          text: 'üìÑ ‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤',
          weight: 'bold',
          size: 'xl'
        },
        {
          type: 'text',
          text: 'PDC-202510-0001',
          size: 'sm',
          color: '#aaaaaa'
        }
      ]
    },
    footer: {
      type: 'box',
      layout: 'vertical',
      contents: [
        {
          type: 'button',
          style: 'primary',
          action: {
            type: 'uri',
            label: 'üìÑ ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤',
            uri: 'https://liff.line.me/2008297943-16G8DPPz?jobId=PDC-202510-0001'
          }
        }
      ]
    }
  }
}
```

## ‡∏™‡∏£‡∏∏‡∏õ

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á LIFF URLs ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô  
**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:** ‡πÄ‡∏û‡∏¥‡πà‡∏° LIFF URLs ‡πÉ‡∏ô Flex Messages ‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô  
**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** LIFF Apps ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô Job ID ‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô ‚úÖ
