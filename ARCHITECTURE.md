# ğŸ—ï¸ PDC Smart Motor Repair - System Architecture

**à¸§à¸±à¸™à¸—à¸µà¹ˆà¸­à¸±à¸à¹€à¸”à¸—:** 17 à¸•à¸¸à¸¥à¸²à¸„à¸¡ 2568

---

## ğŸ“‹ à¸ªà¸²à¸£à¸šà¸±à¸

1. [à¸ à¸²à¸à¸£à¸§à¸¡à¸£à¸°à¸šà¸š](#à¸ à¸²à¸à¸£à¸§à¸¡à¸£à¸°à¸šà¸š)
2. [Entity Relationships](#entity-relationships)
3. [Data Flow](#data-flow)
4. [User Journey](#user-journey)
5. [API Architecture](#api-architecture)
6. [Technology Stack](#technology-stack)

---

## ğŸ¯ à¸ à¸²à¸à¸£à¸§à¸¡à¸£à¸°à¸šà¸š

### **à¸£à¸°à¸šà¸šà¸ˆà¸±à¸”à¸à¸²à¸£à¸‡à¸²à¸™à¸‹à¹ˆà¸­à¸¡à¸¡à¸­à¹€à¸•à¸­à¸£à¹Œà¹à¸šà¸šà¸„à¸£à¸šà¸§à¸‡à¸ˆà¸£**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PDC Smart Motor Repair System                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Internal OA   â”‚                 â”‚  External OA   â”‚
        â”‚   (à¸à¸™à¸±à¸à¸‡à¸²à¸™)    â”‚                 â”‚   (à¸¥à¸¹à¸à¸„à¹‰à¸²)     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            LINE Messaging API                     â”‚
        â”‚            Cloudflare Worker (Webhook Proxy)      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  Google Apps Script   â”‚
                â”‚  (Backend + API)      â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Google Sheets  â”‚  â”‚ Google Docs â”‚  â”‚ Google Drive    â”‚
â”‚ (Database)     â”‚  â”‚ (Templates) â”‚  â”‚ (File Storage)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ Entity Relationships

### **1. Core Entities (à¸•à¸²à¸£à¸²à¸‡à¸«à¸¥à¸±à¸)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Customer   â”‚ â† à¸¥à¸¹à¸à¸„à¹‰à¸²
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ customer_id  â”‚ (PK)
â”‚ company      â”‚
â”‚ contact_name â”‚
â”‚ line_user_id â”‚ â† à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸à¸±à¸š External OA
â”‚ email        â”‚
â”‚ phone        â”‚
â”‚ address      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”‚
       â”‚ N
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Job      â”‚ â† à¸‡à¸²à¸™à¸‹à¹ˆà¸­à¸¡ (à¸•à¸²à¸£à¸²à¸‡à¸«à¸¥à¸±à¸à¸ªà¸¸à¸”)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ job_id       â”‚ (PK) PDC-202510-0001
â”‚ customer_id  â”‚ (FK) â†’ Customer
â”‚ sales_owner  â”‚ (FK) â†’ Users (à¸à¸™à¸±à¸à¸‡à¸²à¸™à¸‚à¸²à¸¢)
â”‚ status       â”‚ DRAFT/PENDING/APPROVED/IN_PROGRESS/COMPLETED
â”‚ milestone    â”‚ RECEIVED/DISASSEMBLY/.../DELIVERY
â”‚ quotation_no â”‚ Q-202510-0001
â”‚ eta_finish   â”‚ à¸à¸³à¸«à¸™à¸”à¸ªà¹ˆà¸‡
â”‚ created_at   â”‚
â”‚ updated_at   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ N               â”‚ N               â”‚ N            â”‚ N
       â–¼                 â–¼                 â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   JobItems   â”‚  â”‚    Media    â”‚  â”‚  Events  â”‚  â”‚Approvals â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ item_id (PK) â”‚  â”‚ media_id    â”‚  â”‚ event_id â”‚  â”‚approval  â”‚
â”‚ job_id (FK)  â”‚  â”‚ job_id (FK) â”‚  â”‚ job_id   â”‚  â”‚job_id    â”‚
â”‚ line_no      â”‚  â”‚ item_id     â”‚  â”‚ actor_id â”‚  â”‚po_no     â”‚
â”‚ title        â”‚  â”‚ milestone   â”‚  â”‚ event    â”‚  â”‚approved  â”‚
â”‚ tech_detail  â”‚  â”‚ type        â”‚  â”‚ payload  â”‚  â”‚  _at     â”‚
â”‚ qty          â”‚  â”‚ drive_file  â”‚  â”‚ created  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ unit_price   â”‚  â”‚   _id       â”‚  â”‚   _at    â”‚
â”‚ subtotal     â”‚  â”‚ created_at  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2. Support Entities (à¸•à¸²à¸£à¸²à¸‡à¸ªà¸™à¸±à¸šà¸ªà¸™à¸¸à¸™)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Users     â”‚       â”‚ TestResults  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ user_id (PK) â”‚       â”‚ job_id (PK)  â”‚ â† 1 Job = 1 Test Result
â”‚ name         â”‚       â”‚ voltage      â”‚
â”‚ role         â”‚       â”‚ current      â”‚
â”‚ internal_    â”‚       â”‚ rpm          â”‚
â”‚   line_user  â”‚       â”‚ ir_mohm      â”‚
â”‚   _id        â”‚       â”‚ vibration    â”‚
â”‚ email        â”‚       â”‚ temp_c       â”‚
â”‚ phone        â”‚       â”‚ tester       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ tested_at    â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow (à¸à¸²à¸£à¹„à¸«à¸¥à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥)

### **Flow 1: à¸ªà¸£à¹‰à¸²à¸‡à¸‡à¸²à¸™à¹ƒà¸«à¸¡à¹ˆ (Job Creation)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: à¸à¸™à¸±à¸à¸‡à¸²à¸™à¸ªà¸£à¹‰à¸²à¸‡à¸‡à¸²à¸™ (Planning/Sales)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Internal OA â†’ LIFF (Job Creation) â†’ Apps Script
                                        â”‚
                                        â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚ createJobWithItems()  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼               â–¼               â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Customer  â”‚   â”‚   Job    â”‚   â”‚  JobItems    â”‚
            â”‚  (Create  â”‚   â”‚ (Create) â”‚   â”‚  (Create 2-5)â”‚
            â”‚   if new) â”‚   â”‚          â”‚   â”‚              â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ generateJobId()â”‚
                        â”‚ PDC-202510-0001â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                        Status = DRAFT
                        Milestone = RECEIVED
```

### **Flow 2: à¸ªà¸£à¹‰à¸²à¸‡à¹ƒà¸šà¹€à¸ªà¸™à¸­à¸£à¸²à¸„à¸² (Quotation)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: à¸ªà¸£à¹‰à¸²à¸‡ Quotation & à¸ªà¹ˆà¸‡à¸¥à¸¹à¸à¸„à¹‰à¸²                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

à¸à¸™à¸±à¸à¸‡à¸²à¸™ (Internal OA) 
    â”‚
    â”œâ”€ à¹€à¸¥à¸·à¸­à¸ Job à¸—à¸µà¹ˆà¸ªà¸–à¸²à¸™à¸° DRAFT
    â”œâ”€ à¸à¸£à¸­à¸à¸£à¸²à¸„à¸²/à¸ªà¹ˆà¸§à¸™à¸¥à¸”/à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”
    â””â”€ à¸à¸” "Generate Quotation"
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ generateQuotation() â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Copy   â”‚ â”‚Replace â”‚ â”‚ Export to â”‚
â”‚ Google â”‚ â”‚ Merge  â”‚ â”‚ PDF       â”‚
â”‚ Docs   â”‚ â”‚ Fields â”‚ â”‚           â”‚
â”‚Templateâ”‚ â”‚        â”‚ â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Save to Google Drive  â”‚
                â”‚ Q-202510-0001.pdf     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Update Job:          â”‚
                â”‚ - quotation_no       â”‚
                â”‚ - quotation_pdf_url  â”‚
                â”‚ - status = PENDING   â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Push LINE to Customer        â”‚
            â”‚ (External OA)                â”‚
            â”‚                              â”‚
            â”‚ "à¹ƒà¸šà¹€à¸ªà¸™à¸­à¸£à¸²à¸„à¸² Q-202510-0001" â”‚
            â”‚ [à¸”à¸¹à¹ƒà¸šà¹€à¸ªà¸™à¸­à¸£à¸²à¸„à¸²] (LIFF)       â”‚
            â”‚ [à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´] [à¸›à¸à¸´à¹€à¸ªà¸˜]          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Flow 3: à¸¥à¸¹à¸à¸„à¹‰à¸²à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´ (Customer Approval)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: à¸¥à¸¹à¸à¸„à¹‰à¸²à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´à¹ƒà¸šà¹€à¸ªà¸™à¸­à¸£à¸²à¸„à¸²                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

à¸¥à¸¹à¸à¸„à¹‰à¸² (External OA)
    â”‚
    â”œâ”€ à¸à¸” "à¸”à¸¹à¹ƒà¸šà¹€à¸ªà¸™à¸­à¸£à¸²à¸„à¸²" â†’ LIFF Quotation App
    â”œâ”€ à¸”à¸¹ PDF Quotation
    â””â”€ à¸à¸” "à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´" à¸«à¸£à¸·à¸­ "à¸›à¸à¸´à¹€à¸ªà¸˜"
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ handleApproval()    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚
    â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Approvalâ”‚ â”‚ Update â”‚ â”‚ Generate  â”‚
â”‚(Create)â”‚ â”‚ Job    â”‚ â”‚ WorkOrder â”‚
â”‚        â”‚ â”‚ Status â”‚ â”‚ PDF       â”‚
â”‚po_no   â”‚ â”‚=APPROV â”‚ â”‚ WO-202510 â”‚
â”‚approvedâ”‚ â”‚ED      â”‚ â”‚   -0001   â”‚
â”‚_at     â”‚ â”‚        â”‚ â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Push LINE:            â”‚
                â”‚                       â”‚
                â”‚ Internal OA:          â”‚
                â”‚ â†’ à¹à¸ˆà¹‰à¸‡à¸à¸™à¸±à¸à¸‡à¸²à¸™à¸§à¹ˆà¸²à¸¡à¸µà¸‡à¸²à¸™ â”‚
                â”‚                       â”‚
                â”‚ External OA:          â”‚
                â”‚ â†’ à¸‚à¸­à¸šà¸„à¸¸à¸“à¸—à¸µà¹ˆà¸­à¸™à¸¸à¸¡à¸±à¸•à¸´    â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Flow 4: à¸­à¸±à¸à¹€à¸”à¸—à¸ªà¸–à¸²à¸™à¸°à¸‡à¸²à¸™ (Status Update)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: à¸Šà¹ˆà¸²à¸‡à¸­à¸±à¸à¹€à¸”à¸—à¸ªà¸–à¸²à¸™à¸°à¸•à¸²à¸¡à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

à¸Šà¹ˆà¸²à¸‡ (Internal OA)
    â”‚
    â”œâ”€ à¹€à¸¥à¸·à¸­à¸ Job
    â”œâ”€ à¹€à¸¥à¸·à¸­à¸ Milestone à¸–à¸±à¸”à¹„à¸›
    â”œâ”€ Upload à¸£à¸¹à¸› 1-3 à¸£à¸¹à¸› (optional)
    â””â”€ à¸à¸” "à¸­à¸±à¸à¹€à¸”à¸—"
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ updateJobStatus()   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚              â”‚
    â–¼          â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Upload â”‚ â”‚ Update â”‚ â”‚ Create   â”‚
â”‚ Images â”‚ â”‚ Job    â”‚ â”‚ Event    â”‚
â”‚ to     â”‚ â”‚        â”‚ â”‚ (Log)    â”‚
â”‚ Drive  â”‚ â”‚milestoneâ”‚ â”‚          â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Create Media â”‚
â”‚ (link photo) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Push LINE to Customerâ”‚
â”‚ (External OA)        â”‚
â”‚                      â”‚
â”‚ "à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸„à¸¸à¸“ PDC-...  â”‚
â”‚  à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™: à¸à¸±à¸™à¸‚à¸”à¸¥à¸§à¸”"  â”‚
â”‚ [à¸”à¸¹à¸£à¸¹à¸›à¸ à¸²à¸]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Flow 5: à¸šà¸±à¸™à¸—à¸¶à¸à¸œà¸¥à¸—à¸”à¸ªà¸­à¸š (Final Test)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: à¸Šà¹ˆà¸²à¸‡à¹„à¸Ÿà¸Ÿà¹‰à¸²à¸šà¸±à¸™à¸—à¸¶à¸à¸œà¸¥à¸—à¸”à¸ªà¸­à¸š                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

à¸Šà¹ˆà¸²à¸‡à¹„à¸Ÿà¸Ÿà¹‰à¸² (Internal OA)
    â”‚
    â”œâ”€ à¹€à¸¥à¸·à¸­à¸ Job
    â”œâ”€ à¸à¸£à¸­à¸: Voltage, Current, RPM, IR, Vibration, Temp
    â”œâ”€ Upload à¸£à¸¹à¸›à¸œà¸¥à¸—à¸”à¸ªà¸­à¸š
    â””â”€ à¸à¸” "à¸šà¸±à¸™à¸—à¸¶à¸"
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ saveTestResult()    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚
    â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”
â”‚ Upload â”‚ â”‚ Create â”‚ â”‚ Updateâ”‚
â”‚ Test   â”‚ â”‚ Test   â”‚ â”‚ Job   â”‚
â”‚ Photos â”‚ â”‚ Result â”‚ â”‚ Statusâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Push LINE to Customer â”‚
                â”‚ "à¸‡à¸²à¸™à¸œà¹ˆà¸²à¸™à¸à¸²à¸£à¸—à¸”à¸ªà¸­à¸š"    â”‚
                â”‚ à¸œà¸¥à¸—à¸”à¸ªà¸­à¸š: âœ…          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Flow 6: à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢ + à¸ªà¹ˆà¸‡à¸¡à¸­à¸š (Final Report & Delivery)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: QC/Planner à¸ªà¸£à¹‰à¸²à¸‡à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

QC/Planner (Internal OA)
    â”‚
    â”œâ”€ à¹€à¸¥à¸·à¸­à¸ Job
    â”œâ”€ à¹€à¸¥à¸·à¸­à¸à¸£à¸¹à¸› Before/After
    â”œâ”€ à¸ªà¸£à¸¸à¸›à¸‡à¸²à¸™à¸‹à¹ˆà¸­à¸¡
    â”œâ”€ à¸à¸³à¸«à¸™à¸” Warranty
    â””â”€ à¸à¸” "Generate Report"
              â”‚
              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ generateFinalReport()â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          â”‚          â”‚
    â–¼          â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Copy   â”‚ â”‚Replace â”‚ â”‚ Export to â”‚
â”‚ Final  â”‚ â”‚ Merge  â”‚ â”‚ PDF       â”‚
â”‚ Report â”‚ â”‚ Fields â”‚ â”‚ FR-202510 â”‚
â”‚Templateâ”‚ â”‚        â”‚ â”‚   -0001   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Update Job:           â”‚
                â”‚ - final_report_pdf    â”‚
                â”‚ - status = COMPLETED  â”‚
                â”‚ - milestone = DELIVERYâ”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Push LINE to Customer        â”‚
            â”‚ (External OA)                â”‚
            â”‚                              â”‚
            â”‚ "à¸‡à¸²à¸™à¹€à¸ªà¸£à¹‡à¸ˆà¸ªà¸´à¹‰à¸™! ğŸ‰"          â”‚
            â”‚ [à¸”à¸¹à¸£à¸²à¸¢à¸‡à¸²à¸™à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢] (PDF)     â”‚
            â”‚ [à¸™à¸±à¸”à¸£à¸±à¸šà¸¡à¸­à¹€à¸•à¸­à¸£à¹Œ]             â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‘¥ User Journey

### **à¸à¸™à¸±à¸à¸‡à¸²à¸™ (Internal OA)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Planner  â”‚ â† à¸£à¸±à¸šà¸‡à¸²à¸™, à¸ªà¸£à¹‰à¸²à¸‡ Quotation
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚   Sales   â”‚ â† à¸•à¸´à¸”à¸•à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸², à¸ªà¹ˆà¸‡ Quotation
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚  Mechanic â”‚ â† à¸‹à¹ˆà¸­à¸¡, à¸­à¸±à¸à¹€à¸”à¸—à¸ªà¸–à¸²à¸™à¸° (9 à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚Electrical â”‚ â† à¸—à¸”à¸ªà¸­à¸šà¹„à¸Ÿà¸Ÿà¹‰à¸²
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚    QC     â”‚ â† à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸¸à¸“à¸ à¸²à¸, à¸ªà¸£à¹‰à¸²à¸‡ Final Report
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚  Packing  â”‚ â† à¹à¸à¹‡à¸„à¸‚à¸­à¸‡, à¸ªà¹ˆà¸‡à¸¡à¸­à¸š
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **à¸¥à¸¹à¸à¸„à¹‰à¸² (External OA)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Add Friend OA  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸£à¸±à¸š Quotation  â”‚ â† LINE Notification
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸”à¸¹ Quotation   â”‚ â† LIFF App (PDF)
â”‚ PDF            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸­à¸™à¸¸à¸¡à¸±à¸•à¸´/à¸›à¸à¸´à¹€à¸ªà¸˜ â”‚ â† Quick Reply
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸•à¸´à¸”à¸•à¸²à¸¡à¸ªà¸–à¸²à¸™à¸°   â”‚ â† LINE Notification (Real-time)
â”‚ (9 à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸£à¸±à¸šà¸£à¸²à¸¢à¸‡à¸²à¸™      â”‚ â† Final Report PDF
â”‚ à¸ªà¸¸à¸”à¸—à¹‰à¸²à¸¢        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ à¸™à¸±à¸”à¸£à¸±à¸šà¸¡à¸­à¹€à¸•à¸­à¸£à¹Œ  â”‚ â† Delivery
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ API Architecture

### **Apps Script Endpoints**

```javascript
// === doGet (GET Requests) ===

GET /exec?action=getJob&jobId=PDC-202510-0001
â†’ Returns Job JSON

GET /exec?action=getJobs&status=IN_PROGRESS
â†’ Returns Jobs Array

GET /exec?action=getQuotation&jobId=PDC-202510-0001
â†’ Returns Quotation PDF URL

GET /exec?action=getAllJobs
â†’ Returns all Jobs (for LIFF apps)

// === doPost (POST Requests) ===

POST /exec
Body: { action: "webhook", events: [...] }
â†’ LINE Webhook (from Cloudflare Worker)

POST /exec
Body: { action: "createJob", data: {...} }
â†’ Create new Job + Customer + JobItems

POST /exec
Body: { action: "updateStatus", jobId: "...", milestone: "..." }
â†’ Update Job status

POST /exec
Body: { action: "saveTestResult", jobId: "...", data: {...} }
â†’ Save Test Result

POST /exec
Body: { action: "generateQuotation", jobId: "..." }
â†’ Generate Quotation PDF

POST /exec
Body: { action: "generateFinalReport", jobId: "..." }
â†’ Generate Final Report PDF
```

### **LINE Webhook Flow**

```
LINE Platform
    â”‚
    â–¼
Cloudflare Worker (Webhook Proxy)
    â”‚
    â”œâ”€ Validate LINE Signature (via query string)
    â”œâ”€ Forward to Apps Script
    â””â”€ Return 200 OK immediately
            â”‚
            â–¼
    Apps Script: doPost()
            â”‚
            â”œâ”€ Parse event type
            â”œâ”€ Detect Internal/External OA
            â”‚
            â”œâ”€ handleMessageEvent()
            â”‚   â”œâ”€ Internal: /help, /jobs, /stats
            â”‚   â””â”€ External: "à¸ªà¸–à¸²à¸™à¸°", "à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸‰à¸±à¸™"
            â”‚
            â”œâ”€ handlePostbackEvent()
            â”‚   â”œâ”€ approve_quote
            â”‚   â”œâ”€ reject_quote
            â”‚   â””â”€ view_job
            â”‚
            â””â”€ handleFollowEvent()
                â””â”€ Welcome message
```

---

## ğŸ› ï¸ Technology Stack

### **Frontend**
- **LIFF SDK**: LINE Front-end Framework
- **HTML5/CSS3/JavaScript**: LIFF Apps UI
- **GitHub Pages**: Static file hosting

### **Backend**
- **Google Apps Script**: Server-side logic
- **Google Sheets API**: Database operations
- **Google Drive API**: File storage
- **Google Docs API**: PDF generation

### **Integration**
- **LINE Messaging API**: Push/Reply messages
- **Cloudflare Worker**: Webhook proxy
- **GitHub Actions**: Auto-deploy (optional)

### **Database**
- **Google Sheets**: Main database (9 sheets)
- **Google Drive**: File storage (PDF, Images)

### **Tools**
- **clasp**: Apps Script CLI
- **Git/GitHub**: Version control
- **VS Code**: Development IDE

---

## ğŸ“Š Database Relationships Diagram

```
Customer 1â”€â”€â”€N Job 1â”€â”€â”€N JobItems
                â”‚
                â”œâ”€â”€â”€N Media
                â”œâ”€â”€â”€N Events
                â”œâ”€â”€â”€1 Approval
                â””â”€â”€â”€1 TestResults

Users â”€â”€â”€N Job (sales_owner)
```

---

## ğŸ¯ Status & Milestone Flow

### **Job Status** (à¸ªà¸–à¸²à¸™à¸°à¸‡à¸²à¸™)
```
DRAFT â†’ PENDING_APPROVAL â†’ APPROVED â†’ IN_PROGRESS â†’ COMPLETED â†’ DELIVERED
  â”‚           â”‚               â”‚            â”‚            â”‚           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            CANCELLED (à¸¢à¸à¹€à¸¥à¸´à¸à¹„à¸”à¹‰à¸—à¸¸à¸à¸‚à¸±à¹‰à¸™)
```

### **Job Milestone** (à¸‚à¸±à¹‰à¸™à¸•à¸­à¸™à¸‡à¸²à¸™ - 14 à¸‚à¸±à¹‰à¸™)
```
1. RECEIVED        (à¸£à¸±à¸šà¸‡à¸²à¸™)
2. INSPECT         (à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™)
3. DISASSEMBLY     (à¸–à¸­à¸”à¸Šà¸´à¹‰à¸™à¸ªà¹ˆà¸§à¸™)
4. BURNOUT         (à¹€à¸œà¸²à¸‚à¸”à¸¥à¸§à¸”)
5. CORE            (à¸—à¸³ Core)
6. REWINDING       (à¸à¸±à¸™à¸‚à¸”à¸¥à¸§à¸”à¹ƒà¸«à¸¡à¹ˆ)
7. VARNISH         (à¹€à¸„à¸¥à¸·à¸­à¸šà¸§à¸²à¸™à¸´à¸Š)
8. ASSEMBLY        (à¸›à¸£à¸°à¸à¸­à¸š)
9. BALANCING       (à¸–à¹ˆà¸§à¸‡à¹à¸šà¸¥à¸²à¸™à¸‹à¹Œ)
10. PAINTING       (à¸à¹ˆà¸™à¸ªà¸µ)
11. ELECTRICAL_TEST (à¸—à¸”à¸ªà¸­à¸šà¹„à¸Ÿà¸Ÿà¹‰à¸²)
12. QC             (à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸¸à¸“à¸ à¸²à¸)
13. PACKING        (à¹à¸à¹‡à¸„à¸‚à¸­à¸‡)
14. DELIVERY       (à¸ªà¹ˆà¸‡à¸¡à¸­à¸š)
```

---

## ğŸ” Security & Best Practices

### **1. LINE Signature Verification**
```javascript
// Cloudflare Worker passes signature via query string
const signature = url.searchParams.get('signature');
verifySignature(body, signature, channelSecret);
```

### **2. User Authentication**
```javascript
// Check if user is Internal (à¸à¸™à¸±à¸à¸‡à¸²à¸™)
function isInternalUser(userId) {
  // Search in Users sheet by internal_line_user_id
  return db.users.findByLineUserId(userId) !== null;
}
```

### **3. Role-Based Access**
```javascript
// Only Planner/Sales can create Job
if (user.role !== 'planner' && user.role !== 'sales') {
  throw new Error('Unauthorized');
}
```

### **4. Data Validation**
```javascript
// Validate Job ID format
if (!/^PDC-\d{6}-\d{4}$/.test(jobId)) {
  throw new Error('Invalid Job ID');
}
```

---

## ğŸ“ˆ Performance Optimization

### **1. Caching**
- Cache frequently accessed data (Customer, Users)
- Use `CacheService` for 6 hours

### **2. Batch Operations**
- Batch insert JobItems (1 API call instead of N)
- Batch update Media records

### **3. Lazy Loading**
- Load images on-demand in LIFF Apps
- Paginate Jobs list (10 per page)

### **4. Background Processing**
- PDF generation in background
- Send LINE notifications asynchronously

---

## ğŸš€ Deployment Flow

```
Development
    â”‚
    â”œâ”€ Edit code in VS Code
    â”œâ”€ Test locally
    â””â”€ Commit to Git
            â”‚
            â–¼
GitHub Repository
            â”‚
            â”œâ”€ Push Apps Script via clasp
            â””â”€ Deploy LIFF Apps via GitHub Pages
                    â”‚
                    â–¼
            Production (Live)
```

---

## ğŸ“ Next Steps

1. âœ… à¸­à¹ˆà¸²à¸™à¹€à¸­à¸à¸ªà¸²à¸£à¸™à¸µà¹‰à¹ƒà¸«à¹‰à¹€à¸‚à¹‰à¸²à¹ƒà¸ˆ
2. âœ… à¸”à¸¹ [SETUP_GUIDE.md](IMPORTANCE/SETUP_GUIDE.md) à¹€à¸à¸·à¹ˆà¸­à¸•à¸´à¸”à¸•à¸±à¹‰à¸‡
3. âœ… à¸—à¸”à¸ªà¸­à¸šà¸ªà¸£à¹‰à¸²à¸‡à¸‡à¸²à¸™ 1 à¸‡à¸²à¸™
4. âœ… à¸—à¸”à¸ªà¸­à¸š Flow à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
5. âœ… Go Live!

---

**Created by:** GitHub Copilot  
**Date:** 17 à¸•à¸¸à¸¥à¸²à¸„à¸¡ 2568  
**Version:** 1.0.0
