/**
 * PDC Smart Motor Repair - Setup Templates & Folders
 * 
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Docs Templates ‡πÅ‡∏•‡∏∞ Google Drive Folders ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
 */

/**
 * Setup ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß)
 */
function setupTemplatesAndFolders() {
  Logger.log('========================================');
  Logger.log('  SETUP TEMPLATES & FOLDERS');
  Logger.log('========================================');
  Logger.log('');
  
  try {
    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Folders
    Logger.log('üìÅ Creating Google Drive Folders...');
    const folders = createDriveFolders();
    Logger.log('‚úÖ Folders created');
    Logger.log('');
    
    // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Templates
    Logger.log('üìÑ Creating Google Docs Templates...');
    const templates = createDocTemplates(folders);
    Logger.log('‚úÖ Templates created');
    Logger.log('');
    
    // 3. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    Logger.log('========================================');
    Logger.log('  SETUP COMPLETE!');
    Logger.log('========================================');
    Logger.log('');
    Logger.log('üìã Copy these IDs to config.js:');
    Logger.log('');
    Logger.log('TEMPLATES: {');
    Logger.log(`  QUOTATION: '${templates.QUOTATION}',`);
    Logger.log(`  WORK_ORDER: '${templates.WORK_ORDER}',`);
    Logger.log(`  FINAL_REPORT: '${templates.FINAL_REPORT}'`);
    Logger.log('},');
    Logger.log('');
    Logger.log('DRIVE_FOLDERS: {');
    Logger.log(`  ROOT: '${folders.ROOT}',`);
    Logger.log(`  QUOTATIONS: '${folders.QUOTATIONS}',`);
    Logger.log(`  WORK_ORDERS: '${folders.WORK_ORDERS}',`);
    Logger.log(`  FINAL_REPORTS: '${folders.FINAL_REPORTS}',`);
    Logger.log(`  PHOTOS_BEFORE: '${folders.PHOTOS_BEFORE}',`);
    Logger.log(`  PHOTOS_PROCESS: '${folders.PHOTOS_PROCESS}',`);
    Logger.log(`  PHOTOS_AFTER: '${folders.PHOTOS_AFTER}',`);
    Logger.log(`  TEST_RESULTS: '${folders.TEST_RESULTS}',`);
    Logger.log(`  DELIVERY: '${folders.DELIVERY}'`);
    Logger.log('},');
    Logger.log('');
    Logger.log('‚úÖ Setup Complete!');
    
    return {
      folders: folders,
      templates: templates
    };
    
  } catch (error) {
    Logger.log('‚ùå Error: ' + error.message);
    throw error;
  }
}

/**
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Drive Folders
 */
function createDriveFolders() {
  const rootFolderName = 'PDC Smart Motor Repair - Documents';
  
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á Root Folder
  const rootFolder = DriveApp.createFolder(rootFolderName);
  
  // ‡∏™‡∏£‡πâ‡∏≤‡∏á Sub Folders
  const quotationsFolder = rootFolder.createFolder('Quotations');
  const workOrdersFolder = rootFolder.createFolder('Work Orders');
  const finalReportsFolder = rootFolder.createFolder('Final Reports');
  const photosBeforeFolder = rootFolder.createFolder('Photos - Before');
  const photosProcessFolder = rootFolder.createFolder('Photos - Process');
  const photosAfterFolder = rootFolder.createFolder('Photos - After');
  const testResultsFolder = rootFolder.createFolder('Test Results');
  const deliveryFolder = rootFolder.createFolder('Delivery Documents');
  
  Logger.log(`‚úÖ Root Folder: ${rootFolder.getName()}`);
  Logger.log(`   URL: ${rootFolder.getUrl()}`);
  
  return {
    ROOT: rootFolder.getId(),
    QUOTATIONS: quotationsFolder.getId(),
    WORK_ORDERS: workOrdersFolder.getId(),
    FINAL_REPORTS: finalReportsFolder.getId(),
    PHOTOS_BEFORE: photosBeforeFolder.getId(),
    PHOTOS_PROCESS: photosProcessFolder.getId(),
    PHOTOS_AFTER: photosAfterFolder.getId(),
    TEST_RESULTS: testResultsFolder.getId(),
    DELIVERY: deliveryFolder.getId()
  };
}

/**
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Docs Templates
 */
function createDocTemplates(folders) {
  const templates = {};
  
  // 1. Quotation Template
  templates.QUOTATION = createQuotationTemplate(folders.ROOT);
  
  // 2. Work Order Template
  templates.WORK_ORDER = createWorkOrderTemplate(folders.ROOT);
  
  // 3. Final Report Template
  templates.FINAL_REPORT = createFinalReportTemplate(folders.ROOT);
  
  return templates;
}

/**
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á Quotation Template
 */
function createQuotationTemplate(folderId) {
  const doc = DocumentApp.create('Template - Quotation');
  const body = doc.getBody();
  
  // Header
  body.appendParagraph('‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏û‡∏µ.‡∏î‡∏µ.‡∏ã‡∏µ. ‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡πÅ‡∏≠‡∏ô‡∏î‡πå ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™ ‡∏à‡∏≥‡∏Å‡∏±‡∏î')
    .setAlignment(DocumentApp.HorizontalAlignment.CENTER)
    .setFontSize(18)
    .setBold(true);
  
  body.appendParagraph('P.D.C. MOTOR & SERVICE CO., LTD.')
    .setAlignment(DocumentApp.HorizontalAlignment.CENTER)
    .setFontSize(14);
  
  body.appendParagraph('‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 123/45 ‡∏ñ‡∏ô‡∏ô‡∏û‡∏£‡∏∞‡∏£‡∏≤‡∏° 3 ‡πÅ‡∏Ç‡∏ß‡∏á‡∏ö‡∏≤‡∏á‡πÇ‡∏û‡∏á‡∏û‡∏≤‡∏á ‡πÄ‡∏Ç‡∏ï‡∏¢‡∏≤‡∏ô‡∏ô‡∏≤‡∏ß‡∏≤ ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø 10120')
    .setAlignment(DocumentApp.HorizontalAlignment.CENTER)
    .setFontSize(10);
  
  body.appendParagraph('‡πÇ‡∏ó‡∏£. 02-XXX-XXXX Email: sales@pdcmotor.com')
    .setAlignment(DocumentApp.HorizontalAlignment.CENTER)
    .setFontSize(10);
  
  body.appendHorizontalRule();
  
  // Title
  body.appendParagraph('')
    .appendText('‡πÉ‡∏ö‡πÄ‡∏™‡∏ô‡∏≠‡∏£‡∏≤‡∏Ñ‡∏≤ / QUOTATION')
    .setFontSize(16)
    .setBold(true);
  
  // Document Info
  body.appendParagraph('‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£: {{quotation_no}}');
  body.appendParagraph('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: {{quotation_date}}');
  body.appendParagraph('Valid Until: {{valid_until}}');
  body.appendParagraph('Job ID: {{job_id}}');
  body.appendParagraph('');
  
  // Customer Info
  body.appendParagraph('‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: {{customer_name}}')
    .setBold(true);
  body.appendParagraph('‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó: {{company}}');
  body.appendParagraph('');
  
  // Motor Info
  body.appendParagraph('‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå:')
    .setBold(true);
  body.appendParagraph('‡∏ä‡∏ô‡∏¥‡∏î: {{asset_desc}}');
  body.appendParagraph('Serial No: {{serial_no}}');
  body.appendParagraph('‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠: {{brand}}');
  body.appendParagraph('‡∏£‡∏∏‡πà‡∏ô: {{model}}');
  body.appendParagraph('');
  
  // Items
  body.appendParagraph('‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏° / Repair Items:')
    .setBold(true);
  body.appendParagraph('{{items_table}}');
  body.appendParagraph('');
  
  // Total
  body.appendParagraph('‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Å‡πà‡∏≠‡∏ô VAT: {{subtotal}}')
    .setAlignment(DocumentApp.HorizontalAlignment.RIGHT);
  body.appendParagraph('VAT 7%: {{vat}}')
    .setAlignment(DocumentApp.HorizontalAlignment.RIGHT);
  body.appendParagraph('‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô: {{total}}')
    .setAlignment(DocumentApp.HorizontalAlignment.RIGHT)
    .setBold(true)
    .setFontSize(14);
  
  body.appendParagraph('');
  body.appendParagraph('‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á ‡∏ß‡∏±‡∏™‡∏î‡∏∏ ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß');
  body.appendParagraph('‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô: ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö 100%');
  
  // Move to folder
  const file = DriveApp.getFileById(doc.getId());
  DriveApp.getFolderById(folderId).addFile(file);
  DriveApp.getRootFolder().removeFile(file);
  
  Logger.log(`‚úÖ Quotation Template created: ${file.getUrl()}`);
  
  return doc.getId();
}

/**
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á Work Order Template
 */
function createWorkOrderTemplate(folderId) {
  const doc = DocumentApp.create('Template - Work Order');
  const body = doc.getBody();
  
  // Header
  body.appendParagraph('‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏û‡∏µ.‡∏î‡∏µ.‡∏ã‡∏µ. ‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡πÅ‡∏≠‡∏ô‡∏î‡πå ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™ ‡∏à‡∏≥‡∏Å‡∏±‡∏î')
    .setAlignment(DocumentApp.HorizontalAlignment.CENTER)
    .setFontSize(18)
    .setBold(true);
  
  body.appendParagraph('‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô / WORK ORDER')
    .setAlignment(DocumentApp.HorizontalAlignment.CENTER)
    .setFontSize(16)
    .setBold(true);
  
  body.appendHorizontalRule();
  
  // Document Info
  body.appendParagraph('‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÉ‡∏ö‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô: {{wo_no}}')
    .setBold(true);
  body.appendParagraph('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: {{wo_date}}');
  body.appendParagraph('Job ID: {{job_id}}');
  body.appendParagraph('');
  
  // Customer Info
  body.appendParagraph('‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: {{customer_name}}');
  body.appendParagraph('‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó: {{company}}');
  body.appendParagraph('');
  
  // Motor Info
  body.appendParagraph('‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå:')
    .setBold(true);
  body.appendParagraph('‡∏ä‡∏ô‡∏¥‡∏î: {{asset_desc}}');
  body.appendParagraph('Serial No: {{serial_no}}');
  body.appendParagraph('‡∏¢‡∏µ‡πà‡∏´‡πâ‡∏≠: {{brand}}');
  body.appendParagraph('‡∏£‡∏∏‡πà‡∏ô: {{model}}');
  body.appendParagraph('‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö: {{eta_finish}}');
  body.appendParagraph('');
  
  // Repair Items
  body.appendParagraph('‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°:')
    .setBold(true);
  body.appendParagraph('{{repair_items}}');
  body.appendParagraph('');
  
  // Sign
  body.appendParagraph('‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô: _____________________');
  body.appendParagraph('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: _____________________');
  body.appendParagraph('');
  body.appendParagraph('‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö: _____________________');
  body.appendParagraph('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: _____________________');
  
  // Move to folder
  const file = DriveApp.getFileById(doc.getId());
  DriveApp.getFolderById(folderId).addFile(file);
  DriveApp.getRootFolder().removeFile(file);
  
  Logger.log(`‚úÖ Work Order Template created: ${file.getUrl()}`);
  
  return doc.getId();
}

/**
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á Final Report Template
 */
function createFinalReportTemplate(folderId) {
  const doc = DocumentApp.create('Template - Final Report');
  const body = doc.getBody();
  
  // Header
  body.appendParagraph('‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏û‡∏µ.‡∏î‡∏µ.‡∏ã‡∏µ. ‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡πÅ‡∏≠‡∏ô‡∏î‡πå ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™ ‡∏à‡∏≥‡∏Å‡∏±‡∏î')
    .setAlignment(DocumentApp.HorizontalAlignment.CENTER)
    .setFontSize(18)
    .setBold(true);
  
  body.appendParagraph('‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏° / FINAL REPORT')
    .setAlignment(DocumentApp.HorizontalAlignment.CENTER)
    .setFontSize(16)
    .setBold(true);
  
  body.appendHorizontalRule();
  
  // Document Info
  body.appendParagraph('‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô: {{report_no}}')
    .setBold(true);
  body.appendParagraph('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: {{report_date}}');
  body.appendParagraph('Job ID: {{job_id}}');
  body.appendParagraph('');
  
  // Customer Info
  body.appendParagraph('‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: {{customer_name}}');
  body.appendParagraph('‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó: {{company}}');
  body.appendParagraph('');
  
  // Motor Info
  body.appendParagraph('‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå:')
    .setBold(true);
  body.appendParagraph('‡∏ä‡∏ô‡∏¥‡∏î: {{asset_desc}}');
  body.appendParagraph('Serial No: {{serial_no}}');
  body.appendParagraph('');
  
  // Repair Summary
  body.appendParagraph('‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°:')
    .setBold(true);
  body.appendParagraph('{{repair_summary}}');
  body.appendParagraph('');
  
  // Test Results
  body.appendParagraph('‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤:')
    .setBold(true);
  body.appendParagraph('‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÑ‡∏ü‡∏ü‡πâ‡∏≤: {{voltage}}');
  body.appendParagraph('‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡πÑ‡∏ü‡∏ü‡πâ‡∏≤: {{current}}');
  body.appendParagraph('‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏£‡∏≠‡∏ö: {{rpm}}');
  body.appendParagraph('‡∏Ñ‡πà‡∏≤ Insulation Resistance: {{ir}}');
  body.appendParagraph('‡∏Ñ‡πà‡∏≤ Vibration: {{vibration}}');
  body.appendParagraph('‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥: {{temperature}}');
  body.appendParagraph('‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö: {{pass_fail}}')
    .setBold(true)
    .setFontSize(14);
  body.appendParagraph('‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: {{test_remark}}');
  body.appendParagraph('');
  
  // Photos
  body.appendParagraph('‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:')
    .setBold(true);
  body.appendParagraph('‡∏î‡∏π‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà: {{photos_url}}');
  body.appendParagraph('');
  
  // Warranty
  body.appendParagraph('‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô: 90 ‡∏ß‡∏±‡∏ô ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏™‡πà‡∏á‡∏°‡∏≠‡∏ö');
  body.appendParagraph('');
  
  // Sign
  body.appendParagraph('‡∏ú‡∏π‡πâ‡∏ó‡∏î‡∏™‡∏≠‡∏ö: _____________________');
  body.appendParagraph('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: _____________________');
  body.appendParagraph('');
  body.appendParagraph('‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥: _____________________');
  body.appendParagraph('‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: _____________________');
  
  // Move to folder
  const file = DriveApp.getFileById(doc.getId());
  DriveApp.getFolderById(folderId).addFile(file);
  DriveApp.getRootFolder().removeFile(file);
  
  Logger.log(`‚úÖ Final Report Template created: ${file.getUrl()}`);
  
  return doc.getId();
}

/**
 * ‡∏ó‡∏î‡∏™‡∏≠‡∏ö - ‡∏•‡∏ö Folders ‡πÅ‡∏•‡∏∞ Templates ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ
 */
function cleanupTemplatesAndFolders() {
  Logger.log('‚ö†Ô∏è  Cleaning up...');
  
  // ‡∏•‡∏ö Root Folder
  const folders = DriveApp.getFoldersByName('PDC Smart Motor Repair - Documents');
  while (folders.hasNext()) {
    const folder = folders.next();
    Logger.log(`üóëÔ∏è  Deleting folder: ${folder.getName()}`);
    folder.setTrashed(true);
  }
  
  // ‡∏•‡∏ö Templates
  ['Template - Quotation', 'Template - Work Order', 'Template - Final Report'].forEach(name => {
    const files = DriveApp.getFilesByName(name);
    while (files.hasNext()) {
      const file = files.next();
      Logger.log(`üóëÔ∏è  Deleting file: ${file.getName()}`);
      file.setTrashed(true);
    }
  });
  
  Logger.log('‚úÖ Cleanup complete');
}
